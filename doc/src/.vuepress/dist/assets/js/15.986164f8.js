(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{64:function(e,r,o){"use strict";o.r(r);var n=o(0),t=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,r=e.$createElement,o=e._self._c||r;return o("div",{staticClass:"content"},[o("h1",{attrs:{id:"установка-серверного-по"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#установка-серверного-по","aria-hidden":"true"}},[e._v("#")]),e._v(" Установка серверного ПО")]),o("h2",{attrs:{id:"образ-и-контейнер"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#образ-и-контейнер","aria-hidden":"true"}},[e._v("#")]),e._v(" Образ и контейнер")]),o("p",[o("strong",[e._v("Образ")]),e._v(" - это слепок файловой системы.")]),o("p",[o("strong",[e._v("Контейнер")]),e._v(" - это живой образ.")]),o("p",[e._v("Можно сделать и обратный вывод:\nОбраз - это мертвый контейнер. Как только в контейнере завершается последний процесс - контейнер умирает.")]),o("h2",{attrs:{id:"распространение-образов"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#распространение-образов","aria-hidden":"true"}},[e._v("#")]),e._v(" Распространение образов")]),o("p",[e._v("Практически все производители ПО имеют официальные образы, распространяемые через "),o("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Hub")]),e._v(".\nДля установки ПО достаточно загрузить образ из "),o("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Hub")]),e._v(". Или из собственного Docker registry.\nУстановка ПО никогда еще не была настолько легкой.\nОбраз можно модифицировать и сохранять локально или в Docker registry.")]),o("h2",{attrs:{id:"запуск-контейнера-docker-run"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#запуск-контейнера-docker-run","aria-hidden":"true"}},[e._v("#")]),e._v(" Запуск контейнера (docker run)")]),o("p",[e._v("Созданный образ можно запустить. Причем типичное время запуска контейнера - 1 секунда.\nВиртуальная машина может запускаться минуту и более.")]),o("p",[e._v("Запустить контейнер очень легко:\n"),o("code",[e._v("docker run -d mongo")]),e._v("\nТакого рода команда бесполезна так, как наружу не выставлены порты.\n"),o("code",[e._v("docker run -d -p 27017:27017 mongo")]),e._v("\nТеперь к MongoDB можно обратиться по указанному порту.\nЕсли вам нужно запустить другой инстанс MongoDB для другого проекта, то необходимо поменять внешний порт.\n"),o("code",[e._v("docker run -d -p 37017:27017 mongo")]),e._v(".\nЕсли внешние для контейнера порты будут одинаковыми, то возникнет конфликт портов на локальной машине.\nТеперь с базой данных можно работать. Данные сохраняются внутри файловой системы контейнера. Однако, все изменения, произошедшие в файловой системе контейнера, после его остановки исчезают. Контейнеры по своей природе stateless, то есть не сохраняют состояние. У этого есть огромные плюсы, о которых мы поговорим чуть позже.")]),o("p",[e._v("Для сохранения данных необходимо использовать внешние для контейнера тома.\n"),o("code",[e._v("docker run -d -p 27017:27017 --volume=./data/mongo:/db/data mongo")]),e._v("\nКроме того внешние тома можно использовать для чтения. Например внутрь контейнера можно прокинуть такие файлы как "),o("code",[e._v("/etc/passwd")]),e._v(" и "),o("code",[e._v("/etc/group")]),e._v(". После этого внутри контейнера у вас окажется тот же набор пользователей и групп, что и на хост машине.")]),o("h2",{attrs:{id:"dockerfile"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile","aria-hidden":"true"}},[e._v("#")]),e._v(" Dockerfile")]),o("p",[e._v("Вместо использования готовых образов можно подготовить свой образ.\nДелается это с помощью файла Dockerfile.")]),o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('FROM mongo:3-jessie\n\nCOPY ./mongo.conf /usr/local/etc/mongo/mongo.conf\nEXPOSE 27017\n\nCMD ["mongod"]\n')])]),o("p",[e._v("В этом примере мы заменили стандартный конфиг на свой.")]),o("h2",{attrs:{id:"запуск-набора-контейнеров-docker-compose"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#запуск-набора-контейнеров-docker-compose","aria-hidden":"true"}},[e._v("#")]),e._v(" Запуск набора контейнеров (docker-compose)")]),o("p",[e._v("Параметров для запуска может быть довольно много и указывать их все может быть весьма утомительно.\nЧтобы избежать этого можно воспользоваться docker-compose. Эта утилита позволяет запускать один или более контейнеров с параметрами указанными в файле docker-compose.yml\nПостроение образов и запуск контейнеров: "),o("code",[e._v("docker-compose up --build -d")]),e._v("\nПостроение образа может занять некоторое время. Запуск же очень быстрый. Перестройка образа может понадобиться только в случае изменения параметров или файлов, которые копируются внутрь образа.")]),o("h3",{attrs:{id:"пример-docker-compose-yml"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#пример-docker-compose-yml","aria-hidden":"true"}},[e._v("#")]),e._v(" Пример docker-compose.yml")]),o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("version: '2'\n\nservices:\n  mongo:\n    image: mongo:3-jessie\n    container_name: mongodb\n    volumes:\n      - ./data/mongo:/data/db\n    networks:\n      - skynet\n    restart: always\n    entrypoint:\n      mongod\n      \nnetworks:\n  skynet:\n    driver: bridge\n    ipam:\n      driver: default\n      config:\n        - subnet: 10.1.0.1/24\n")])]),o("h3",{attrs:{id:"запуск-сервиса-внутри-контейнера-docker-compose-run"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#запуск-сервиса-внутри-контейнера-docker-compose-run","aria-hidden":"true"}},[e._v("#")]),e._v(" Запуск сервиса внутри контейнера (docker-compose run)")]),o("p",[o("code",[e._v("docker-compose run service-name")]),e._v("\nПо имени сервиса находит образ, указанный в файле docker-compose.yml и  запускает контейнер, с параметрами из того же файла. Из параметров не применяются только порты, которые выставляются наружу контейнера. Такое поведение необходимо во избегание коллизий с портами. Однако если же вы хотите выставлять наружу те же порты, которые указаны в docker-compose.yml достаточно указать параметр "),o("code",[e._v("--service-ports")]),e._v(".")])])}],!1,null,null,null);r.default=t.exports}}]);