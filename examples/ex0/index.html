<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Установка серверного ПО | Docker Driven Development</title>
    <meta name="description" content="Использование docker в процессе разработки">
    
    
    <link rel="preload" href="/docker-driven-development/assets/css/styles.000be64f.css" as="style"><link rel="preload" href="/docker-driven-development/assets/js/app.000be64f.js" as="script"><link rel="preload" href="/docker-driven-development/assets/js/5.3e6a4876.js" as="script"><link rel="prefetch" href="/docker-driven-development/assets/js/10.507cd805.js"><link rel="prefetch" href="/docker-driven-development/assets/css/1.styles.babd7481.css"><link rel="prefetch" href="/docker-driven-development/assets/js/1.babd7481.js"><link rel="prefetch" href="/docker-driven-development/assets/css/2.styles.1bc76466.css"><link rel="prefetch" href="/docker-driven-development/assets/js/2.1bc76466.js"><link rel="prefetch" href="/docker-driven-development/assets/js/3.a44f7e52.js"><link rel="prefetch" href="/docker-driven-development/assets/js/4.2a240cef.js"><link rel="prefetch" href="/docker-driven-development/assets/js/6.7f024648.js"><link rel="prefetch" href="/docker-driven-development/assets/js/7.9bc76ef6.js"><link rel="prefetch" href="/docker-driven-development/assets/js/8.ba7dd04a.js"><link rel="prefetch" href="/docker-driven-development/assets/js/9.91e0d23b.js"><link rel="prefetch" href="/docker-driven-development/assets/js/11.5b977379.js"><link rel="prefetch" href="/docker-driven-development/assets/js/12.e34004d5.js"><link rel="prefetch" href="/docker-driven-development/assets/js/13.e6527ed4.js"><link rel="prefetch" href="/docker-driven-development/assets/js/14.c1ca858d.js"><link rel="prefetch" href="/docker-driven-development/assets/js/15.e075a09a.js"><link rel="prefetch" href="/docker-driven-development/assets/js/16.03d5fdc0.js"><link rel="prefetch" href="/docker-driven-development/assets/js/17.6eedae71.js"><link rel="prefetch" href="/docker-driven-development/assets/js/18.b391c345.js"><link rel="prefetch" href="/docker-driven-development/assets/js/19.701c4214.js"><link rel="prefetch" href="/docker-driven-development/assets/js/20.b7806461.js"><link rel="prefetch" href="/docker-driven-development/assets/js/21.7e6357ab.js"><link rel="prefetch" href="/docker-driven-development/assets/js/22.16591560.js"><link rel="prefetch" href="/docker-driven-development/assets/js/23.fef4c0fb.js">
    <link rel="stylesheet" href="/docker-driven-development/assets/css/1.styles.babd7481.css"><link rel="stylesheet" href="/docker-driven-development/assets/css/2.styles.1bc76466.css"><link rel="stylesheet" href="/docker-driven-development/assets/css/styles.000be64f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docker-driven-development/" class="home-link router-link-active"><!----> <span class="site-name">Docker Driven Development</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/aak74/docker-driven-development" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"> <a href="https://github.com/aak74/docker-driven-development" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Введение</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Примеры использования</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/docker-driven-development/examples/" class="sidebar-link">Примеры</a></li><li><a href="/docker-driven-development/examples/ex0/" class="active sidebar-link">Установка серверного ПО</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docker-driven-development/examples/ex0/#образ-и-контейнер" class="sidebar-link">Образ и контейнер</a></li><li class="sidebar-sub-header"><a href="/docker-driven-development/examples/ex0/#распространение-образов" class="sidebar-link">Распространение образов</a></li><li class="sidebar-sub-header"><a href="/docker-driven-development/examples/ex0/#запуск-контейнера-docker-run" class="sidebar-link">Запуск контейнера (docker run)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docker-driven-development/examples/ex0/#порты" class="sidebar-link">Порты</a></li><li class="sidebar-sub-header"><a href="/docker-driven-development/examples/ex0/#тома" class="sidebar-link">Тома</a></li></ul></li><li class="sidebar-sub-header"><a href="/docker-driven-development/examples/ex0/#dockerfile" class="sidebar-link">Dockerfile</a></li><li class="sidebar-sub-header"><a href="/docker-driven-development/examples/ex0/#docker-compose" class="sidebar-link">docker-compose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docker-driven-development/examples/ex0/#запуск-набора-контейнеров" class="sidebar-link">Запуск набора контейнеров</a></li><li class="sidebar-sub-header"><a href="/docker-driven-development/examples/ex0/#пример-docker-compose-yml" class="sidebar-link">Пример docker-compose.yml</a></li><li class="sidebar-sub-header"><a href="/docker-driven-development/examples/ex0/#запуск-сервиса-внутри-контейнера-docker-compose-run" class="sidebar-link">Запуск сервиса внутри контейнера (docker-compose run)</a></li></ul></li></ul></li><li><a href="/docker-driven-development/examples/ex10/" class="sidebar-link">Запуск простого проекта на локальном компьютере</a></li><li><a href="/docker-driven-development/examples/ex11/" class="sidebar-link">Добавляем БД</a></li><li><a href="/docker-driven-development/examples/ex12/" class="sidebar-link">Тестирование с использованием БД</a></li><li><a href="/docker-driven-development/examples/ex13/" class="sidebar-link">Полноценное использование БД</a></li><li><a href="/docker-driven-development/examples/ex14/" class="sidebar-link">Переключение между состояниями БД</a></li><li><a href="/docker-driven-development/examples/ex20/" class="sidebar-link">Переключение между настройками одного и того же ПО</a></li><li><a href="/docker-driven-development/examples/ex2/" class="sidebar-link">Переключение между версиями ПО</a></li><li><a href="/docker-driven-development/examples/ex3/" class="sidebar-link">Переключение между пользователями</a></li><li><a href="/docker-driven-development/examples/ex5/" class="sidebar-link">Тестирование с использованием mock-сервиса</a></li></ul></div></li><li><a href="/docker-driven-development/extra/" class="sidebar-link">Дополнительные вопросы</a></li><li><a href="/docker-driven-development/summary/" class="sidebar-link">Выводы</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="установка-серверного-по"><a href="#установка-серверного-по" aria-hidden="true" class="header-anchor">#</a> Установка серверного ПО</h1> <h2 id="образ-и-контейнер"><a href="#образ-и-контейнер" aria-hidden="true" class="header-anchor">#</a> Образ и контейнер</h2> <p>Терминология не является официальной.
<strong>Образ</strong> - это слепок файловой системы.</p> <p><strong>Контейнер</strong> - это оживший образ.</p> <p>Можно сделать и обратный вывод:
Образ - это мертвый контейнер. Как только в контейнере завершается последний процесс - контейнер умирает.</p> <h2 id="распространение-образов"><a href="#распространение-образов" aria-hidden="true" class="header-anchor">#</a> Распространение образов</h2> <p>Практически все производители ПО имеют официальные образы, распространяемые через <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
Для установки ПО достаточно загрузить образ из <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Или из собственного Docker registry.
<strong>Установка ПО никогда еще не была настолько легкой</strong>.
Образ можно модифицировать и сохранять локально или в Docker registry.</p> <h2 id="запуск-контейнера-docker-run"><a href="#запуск-контейнера-docker-run" aria-hidden="true" class="header-anchor">#</a> Запуск контейнера (docker run)</h2> <p>Созданный образ можно запустить. Причем типичное время запуска контейнера - 1 секунда и менее.
Виртуальная машина может запускаться минуту и более.</p> <p>Запустить контейнер очень легко:
<code>docker run -d mongo</code>
Если вы ранее не скачивали образ, то он скачается  автоматически.
Правда воспользоваться прелестной MongoDB не получится, потому что наружу не выставлены порты.</p> <h3 id="порты"><a href="#порты" aria-hidden="true" class="header-anchor">#</a> Порты</h3> <p>Для исправления ситуации воспользуемся командой:
<code>docker run -d -p 27017:27017 mongo</code>
Теперь к MongoDB можно обратиться по порту <code>27017</code>.</p> <p>Если вам одновременно нужно запустить более одного инстанса MongoDB, то необходимо поменять внешний порт.
<code>docker run -d -p 37017:27017 mongo</code>.</p> <p>Если внешние для контейнера порты будут одинаковыми, то возникнет конфликт портов на локальной машине.</p> <p>Теперь с базой данных можно работать. Данные сохраняются внутри файловой системы контейнера. Однако, все изменения, произошедшие в файловой системе контейнера, после его остановки исчезают. <strong>Контейнеры по своей природе stateless, то есть не сохраняют состояние</strong>. У этого есть огромные плюсы, о которых мы поговорим чуть позже.</p> <h3 id="тома"><a href="#тома" aria-hidden="true" class="header-anchor">#</a> Тома</h3> <p>Для сохранения данных необходимо использовать внешние для контейнера тома.
<code>docker run -d -p 27017:27017 --volume=./data/mongo:/db/data mongo</code>
Кроме того внешние тома можно использовать для чтения. Например внутрь контейнера можно прокинуть такие файлы как <code>/etc/passwd</code> и <code>/etc/group</code>. После этого внутри контейнера у вас окажется тот же набор пользователей и групп, что и на хост машине.</p> <h2 id="dockerfile"><a href="#dockerfile" aria-hidden="true" class="header-anchor">#</a> Dockerfile</h2> <p>Часто готовых образов недостаточно для комфортного использования.
Вместо использования готовых образов можно подготовить свой образ.
Делается это с помощью файла Dockerfile.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token constant">FROM</span> mongo<span class="token punctuation">:</span><span class="token number">3</span><span class="token operator">-</span>jessie

<span class="token constant">COPY</span> <span class="token punctuation">.</span><span class="token operator">/</span>mongo<span class="token punctuation">.</span>conf <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>mongo<span class="token operator">/</span>mongo<span class="token punctuation">.</span>conf
<span class="token constant">EXPOSE</span> <span class="token number">27017</span>

<span class="token constant">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;mongod&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>В этом примере мы заменили стандартный конфиг на свой.</p> <h2 id="docker-compose"><a href="#docker-compose" aria-hidden="true" class="header-anchor">#</a> docker-compose</h2> <p>Параметров для запуска может быть довольно много и указывать их все может быть весьма утомительно.
Чтобы избежать этого можно воспользоваться docker-compose. Эта утилита позволяет запускать один или более контейнеров с параметрами указанными в файле <code>docker-compose.yml</code>.
Построение образов и запуск контейнеров: <code>docker-compose up --build -d</code>
Построение образа может занять некоторое время. Запуск же очень быстрый. Перестройка образа может понадобиться только в случае изменения параметров или файлов, которые копируются внутрь образа.</p> <h3 id="запуск-набора-контейнеров"><a href="#запуск-набора-контейнеров" aria-hidden="true" class="header-anchor">#</a> Запуск набора контейнеров</h3> <p>При необходимости в <code>docker-compose.yml</code> можно поместить описание нескольких сервисов.
После запуска контейнеров командой <code>docker-compose up --build -d</code> вы получите набор запущенных контейнеров, которые работают в одной виртуальной сети.</p> <h3 id="пример-docker-compose-yml"><a href="#пример-docker-compose-yml" aria-hidden="true" class="header-anchor">#</a> Пример docker-compose.yml</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mongo</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo<span class="token punctuation">:</span>3<span class="token punctuation">-</span>jessie
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mongodb
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./data/mongo<span class="token punctuation">:</span>/data/db
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> skynet
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span>
      mongod
      
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">skynet</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge
    <span class="token key atrule">ipam</span><span class="token punctuation">:</span>
      <span class="token key atrule">driver</span><span class="token punctuation">:</span> default
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">subnet</span><span class="token punctuation">:</span> 10.1.0.1/24
</code></pre></div><h3 id="запуск-сервиса-внутри-контейнера-docker-compose-run"><a href="#запуск-сервиса-внутри-контейнера-docker-compose-run" aria-hidden="true" class="header-anchor">#</a> Запуск сервиса внутри контейнера (docker-compose run)</h3> <p>Бывает удобно запускать ПО прям из контейнера.</p> <p>Делается это так:
<code>docker-compose run service-name</code>
По имени сервиса находит сервис, указанный в файле docker-compose.yml и  запускает контейнер, с параметрами из того же файла. Из параметров не применяются только порты, даже если они и указаны в файле <code>docker-compose.yml</code>. Такое поведение необходимо во избежание коллизий с портами. Однако если же вы хотите выставлять наружу те же порты, которые указаны в <code>docker-compose.yml</code> достаточно указать параметр <code>--service-ports</code>.</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/aak74/docker-driven-development/edit/master/doc/src/examples/ex0/README.md" target="_blank" rel="noopener noreferrer">Помоги улучшить страницу!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docker-driven-development/examples/" class="prev router-link-active">
          Примеры
        </a></span> <span class="next"><a href="/docker-driven-development/examples/ex10/">
          Запуск простого проекта на локальном компьютере
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/docker-driven-development/assets/js/5.3e6a4876.js" defer></script><script src="/docker-driven-development/assets/js/app.000be64f.js" defer></script>
  </body>
</html>
