(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{181:function(t,s,e){"use strict";e.r(s);var a=e(0),n=Object(a.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),e("p",[t._v("Можно сделать и обратный вывод:\nОбраз - это мертвый контейнер. Как только в контейнере завершается последний процесс - контейнер умирает.")]),t._v(" "),t._m(4),t._v(" "),e("p",[t._v("Практически все производители ПО имеют официальные образы, распространяемые через "),e("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Hub"),e("OutboundLink")],1),t._v(".\nДля установки ПО достаточно загрузить образ из "),e("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Hub"),e("OutboundLink")],1),t._v(". Или из собственного Docker registry.\n"),e("strong",[t._v("Установка ПО никогда еще не была настолько легкой")]),t._v(".\nОбраз можно модифицировать и сохранять локально или в Docker registry.")]),t._v(" "),t._m(5),t._v(" "),e("p",[t._v("Созданный образ можно запустить. Причем типичное время запуска контейнера - 1 секунда и менее.\nВиртуальная машина может запускаться минуту и более.")]),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),e("p",[t._v("Если внешние для контейнера порты будут одинаковыми, то возникнет конфликт портов на локальной машине.")]),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),e("p",[t._v("Часто готовых образов недостаточно для комфортного использования.\nВместо использования готовых образов можно подготовить свой образ.\nДелается это с помощью файла Dockerfile.")]),t._v(" "),t._m(14),e("p",[t._v("В этом примере мы заменили стандартный конфиг на свой.")]),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._m(21),t._v(" "),e("p",[t._v("Бывает удобно запускать ПО прям из контейнера.")]),t._v(" "),t._m(22)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"установка-серверного-по"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#установка-серверного-по","aria-hidden":"true"}},[this._v("#")]),this._v(" Установка серверного ПО")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"образ-и-контейнер"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#образ-и-контейнер","aria-hidden":"true"}},[this._v("#")]),this._v(" Образ и контейнер")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Терминология не является официальной.\n"),s("strong",[this._v("Образ")]),this._v(" - это слепок файловой системы.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("Контейнер")]),this._v(" - это оживший образ.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"распространение-образов"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#распространение-образов","aria-hidden":"true"}},[this._v("#")]),this._v(" Распространение образов")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"запуск-контейнера-docker-run"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#запуск-контейнера-docker-run","aria-hidden":"true"}},[this._v("#")]),this._v(" Запуск контейнера (docker run)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Запустить контейнер очень легко:\n"),s("code",[this._v("docker run -d mongo")]),this._v("\nЕсли вы ранее не скачивали образ, то он скачается  автоматически.\nПравда воспользоваться прелестной MongoDB не получится, потому что наружу не выставлены порты.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"порты"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#порты","aria-hidden":"true"}},[this._v("#")]),this._v(" Порты")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Для исправления ситуации воспользуемся командой:\n"),s("code",[this._v("docker run -d -p 27017:27017 mongo")]),this._v("\nТеперь к MongoDB можно обратиться по порту "),s("code",[this._v("27017")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Если вам одновременно нужно запустить более одного инстанса MongoDB, то необходимо поменять внешний порт.\n"),s("code",[this._v("docker run -d -p 37017:27017 mongo")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Теперь с базой данных можно работать. Данные сохраняются внутри файловой системы контейнера. Однако, все изменения, произошедшие в файловой системе контейнера, после его остановки исчезают. "),s("strong",[this._v("Контейнеры по своей природе stateless, то есть не сохраняют состояние")]),this._v(". У этого есть огромные плюсы, о которых мы поговорим чуть позже.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"тома"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#тома","aria-hidden":"true"}},[this._v("#")]),this._v(" Тома")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Для сохранения данных необходимо использовать внешние для контейнера тома.\n"),s("code",[this._v("docker run -d -p 27017:27017 --volume=./data/mongo:/db/data mongo")]),this._v("\nКроме того внешние тома можно использовать для чтения. Например внутрь контейнера можно прокинуть такие файлы как "),s("code",[this._v("/etc/passwd")]),this._v(" и "),s("code",[this._v("/etc/group")]),this._v(". После этого внутри контейнера у вас окажется тот же набор пользователей и групп, что и на хост машине.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile","aria-hidden":"true"}},[this._v("#")]),this._v(" Dockerfile")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-jsx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-jsx"}},[e("code",[e("span",{attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" mongo"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{attrs:{class:"token number"}},[t._v("3")]),e("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("jessie\n\n"),e("span",{attrs:{class:"token constant"}},[t._v("COPY")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("mongo"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf "),e("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),e("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),e("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),e("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("mongo"),e("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("mongo"),e("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),e("span",{attrs:{class:"token constant"}},[t._v("EXPOSE")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("27017")]),t._v("\n\n"),e("span",{attrs:{class:"token constant"}},[t._v("CMD")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{attrs:{class:"token string"}},[t._v('"mongod"')]),e("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"docker-compose"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose","aria-hidden":"true"}},[this._v("#")]),this._v(" docker-compose")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Параметров для запуска может быть довольно много и указывать их все может быть весьма утомительно.\nЧтобы избежать этого можно воспользоваться docker-compose. Эта утилита позволяет запускать один или более контейнеров с параметрами указанными в файле "),s("code",[this._v("docker-compose.yml")]),this._v(".\nПостроение образов и запуск контейнеров: "),s("code",[this._v("docker-compose up --build -d")]),this._v("\nПостроение образа может занять некоторое время. Запуск же очень быстрый. Перестройка образа может понадобиться только в случае изменения параметров или файлов, которые копируются внутрь образа.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"запуск-набора-контейнеров"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#запуск-набора-контейнеров","aria-hidden":"true"}},[this._v("#")]),this._v(" Запуск набора контейнеров")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("При необходимости в "),s("code",[this._v("docker-compose.yml")]),this._v(" можно поместить описание нескольких сервисов.\nПосле запуска контейнеров командой "),s("code",[this._v("docker-compose up --build -d")]),this._v(" вы получите набор запущенных контейнеров, которые работают в одной виртуальной сети.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"пример-docker-compose-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#пример-docker-compose-yml","aria-hidden":"true"}},[this._v("#")]),this._v(" Пример docker-compose.yml")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{attrs:{class:"token key atrule"}},[t._v("version")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'2'")]),t._v("\n\n"),e("span",{attrs:{class:"token key atrule"}},[t._v("services")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{attrs:{class:"token key atrule"}},[t._v("mongo")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{attrs:{class:"token key atrule"}},[t._v("image")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mongo"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3"),e("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("jessie\n    "),e("span",{attrs:{class:"token key atrule"}},[t._v("container_name")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mongodb\n    "),e("span",{attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data/mongo"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data/db\n    "),e("span",{attrs:{class:"token key atrule"}},[t._v("networks")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" skynet\n    "),e("span",{attrs:{class:"token key atrule"}},[t._v("restart")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),e("span",{attrs:{class:"token key atrule"}},[t._v("entrypoint")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      mongod\n      \n"),e("span",{attrs:{class:"token key atrule"}},[t._v("networks")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{attrs:{class:"token key atrule"}},[t._v("skynet")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{attrs:{class:"token key atrule"}},[t._v("driver")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bridge\n    "),e("span",{attrs:{class:"token key atrule"}},[t._v("ipam")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{attrs:{class:"token key atrule"}},[t._v("driver")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n      "),e("span",{attrs:{class:"token key atrule"}},[t._v("config")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{attrs:{class:"token key atrule"}},[t._v("subnet")]),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.1.0.1/24\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"запуск-сервиса-внутри-контейнера-docker-compose-run"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#запуск-сервиса-внутри-контейнера-docker-compose-run","aria-hidden":"true"}},[this._v("#")]),this._v(" Запуск сервиса внутри контейнера (docker-compose run)")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("Делается это так:\n"),e("code",[t._v("docker-compose run service-name")]),t._v("\nПо имени сервиса находит сервис, указанный в файле docker-compose.yml и  запускает контейнер, с параметрами из того же файла. Из параметров не применяются только порты, даже если они и указаны в файле "),e("code",[t._v("docker-compose.yml")]),t._v(". Такое поведение необходимо во избежание коллизий с портами. Однако если же вы хотите выставлять наружу те же порты, которые указаны в "),e("code",[t._v("docker-compose.yml")]),t._v(" достаточно указать параметр "),e("code",[t._v("--service-ports")]),t._v(".")])}],!1,null,null,null);n.options.__file="README.md";s.default=n.exports}}]);